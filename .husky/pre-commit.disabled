#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

# TypeScript type checking
echo "\nğŸ“ Checking TypeScript types..."
pnpm exec tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript errors detected. Fix before committing."
  exit 1
fi

# Database schema sync check
echo "\nğŸ—„ï¸  Checking database schema sync..."
pnpm db:push --dry-run 2>&1 | grep -q "No schema changes"
if [ $? -ne 0 ]; then
  echo "âš ï¸  Schema drift detected. Run 'pnpm db:push' to sync."
  echo "   (Continuing commit - manual verification required)"
fi

# Run tests
echo "\nğŸ§ª Running tests..."
pnpm test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Fix before committing."
  exit 1
fi

echo "\nâœ… All pre-commit checks passed!"
